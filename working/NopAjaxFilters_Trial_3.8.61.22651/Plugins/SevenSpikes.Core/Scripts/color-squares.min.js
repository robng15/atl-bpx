/*
* Copyright 2016 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

(function (n, t, i) { function f() { var n = []; return t(r).each(function () { var i = t(this).attr("data-productid"), r; i && i > 0 && (r = { productId: i, productElement: t(this) }, n.push(r)) }), n } function e(n, r) { var h = i.getAttrValFromDom(u, "data-productbox-container-selector"), f, o, e, s; h && ((f = r.productElement.find(h), f.find("ul.color-squares").length > 0) || f && r.productId && r.productId > 0 && (o = r.productId, e = t(n).filter("ul[data-productId='" + o + "']"), e && e.length > 0 && (t(f).append(e), t(f).addClass("color-squares-active"), s = t(".product-item").has("[data-productid=" + o + "]"), s.find(" .second-product-image").remove(), s.find(".product-box-color-square.preselected").click()))) } function o(n, t) { if (t && t.length > 0) for (var i = 0; i < t.length; i++) e(n, t[i]) } function s() { return i.getAttrValFromDom(u, "data-retrieve-color-squares-url") } var r, u = "#color-squares-info"; n.getColorSquares = function () { var n = f(), r, i, u, e, h; if (n && n.length !== 0) { for (r = [], i = 0; i < n.length; i++) u = n[i], u.hasOwnProperty("productId") && r.push(u.productId); e = { productIds: r }; h = s(); t.ajax({ cache: !1, type: "POST", data: t.toJSON(e), contentType: "application/json; charset=utf-8", url: h, success: function (i) { i && (o(i, n), t.event.trigger({ type: "colorSquaresLoadingCompleteEvent" })) }, error: function () { return } }) } }; t(document).ready(function () { (r = i.getAttrValFromDom(u, "data-productbox-selector"), r) && n.getColorSquares() }); t(document).on("click", ".product-box-color-square", function () { var n = t(this), u = n.closest("li"), e, r, f; u.hasClass("selected-value") || (e = i.getAttrValFromDom("#color-squares-info", "data-product-attribute-change-url"), r = n.closest(".product-item").data("productid"), r && r > 0 && (f = {}, f[n.attr("name")] = n.attr("value"), t.ajax({ cache: !1, url: e + "?productId=" + r + "&validateAttributeConditions=true&loadpicture=true", data: f, type: "POST", success: function (t) { var u, r, f; t.price && (u = i.getAttrValFromDom("#color-squares-info", "data-productbox-price-selector"), r = n.closest(".product-item").find(u), r.length > 0 && r.text(t.price)); t.pictureDefaultSizeUrl && (f = n.closest(".product-item").find(".picture img"), f.attr("src", t.pictureDefaultSizeUrl)) } })), u.addClass("selected-value"), u.siblings(".selected-value").removeClass("selected-value")) }); t(document).on("nopAjaxFiltersFiltrationCompleteEvent newProductsAddedToPageEvent", n.getColorSquares) })(window.colorSquares = window.colorSquares || {}, jQuery, sevenSpikes);